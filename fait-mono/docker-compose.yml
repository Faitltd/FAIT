version: '3.8'

services:
  # Nginx reverse proxy for handling subdomains
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/conf:/etc/nginx/conf.d
      - ./nginx/ssl:/etc/nginx/ssl
      - ./nginx/www:/var/www/html
    depends_on:
      - fait-coop
      - offershield
      - offershield-sveltekit
      - home-health-score
      - handyman-calculator
      - flippercalc
      - flippercalc-sveltekit
      - remodeling-calculator
      - fait-hub-sveltekit
    networks:
      - fait-network

  # FAIT Coop Vue application
  fait-coop:
    build:
      context: .
      dockerfile: apps/fait-coop/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
      - VITE_SUPABASE_URL=${SUPABASE_URL}
      - VITE_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - VITE_GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - VITE_STRIPE_PUBLIC_KEY=${STRIPE_PUBLIC_KEY}
    networks:
      - fait-network

  # OfferShield Next.js application
  offershield:
    build:
      context: .
      dockerfile: apps/offershield/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
      - NEXT_PUBLIC_SUPABASE_URL=${SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=${STRIPE_PUBLISHABLE_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
    networks:
      - fait-network

  # HomeHealthScore Next.js application
  home-health-score:
    build:
      context: .
      dockerfile: apps/home-health-score/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
      - NEXT_PUBLIC_SUPABASE_URL=${SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
    networks:
      - fait-network

  # Handyman Calculator (While-You're-Here)
  handyman-calculator:
    build:
      context: .
      dockerfile: apps/handyman-calculator/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
    networks:
      - fait-network

  # FlipperCalc application
  flippercalc:
    build:
      context: .
      dockerfile: apps/flippercalc/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
    networks:
      - fait-network

  # Remodeling Calculator application
  remodeling-calculator:
    build:
      context: .
      dockerfile: apps/remodeling-calculator/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
    networks:
      - fait-network

  # Home Depot Scraper tool
  home-depot-scraper:
    build:
      context: .
      dockerfile: tools/home-depot-scraper/Dockerfile
    environment:
      - PORT=8080
      - BIGBOX_API_KEY=${BIGBOX_API_KEY}
    volumes:
      - scraper-data:/app/data
    networks:
      - fait-network

  # FAIT Hub SvelteKit application
  fait-hub-sveltekit:
    build:
      context: .
      dockerfile: apps/fait-hub-sveltekit/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
      - PUBLIC_SUPABASE_URL=${SUPABASE_URL}
      - PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
    networks:
      - fait-network

  # FlipperCalc SvelteKit application
  flippercalc-sveltekit:
    build:
      context: .
      dockerfile: apps/flippercalc-sveltekit/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
      - PUBLIC_SUPABASE_URL=${SUPABASE_URL}
      - PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
    networks:
      - fait-network

  # OfferShield SvelteKit application
  offershield-sveltekit:
    build:
      context: .
      dockerfile: apps/offershield-sveltekit/Dockerfile
    environment:
      - NODE_ENV=production
      - PORT=8080
      - PUBLIC_SUPABASE_URL=${SUPABASE_URL}
      - PUBLIC_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - PUBLIC_STRIPE_PUBLISHABLE_KEY=${STRIPE_PUBLISHABLE_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
    networks:
      - fait-network

networks:
  fait-network:
    driver: bridge

volumes:
  scraper-data:
